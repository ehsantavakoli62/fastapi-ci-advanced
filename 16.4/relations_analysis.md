# تحلیل روابط بین جداول (تمرین ۱۶.۴ - وظیفه ۱)

در این طرح، ۵ نوع رابطه بین ۴ جدول وجود دارد:

| جدول مبدأ (Source) | جدول مقصد (Target) | نوع رابطه | توجیه |
| :--- | :--- | :--- | :--- |
| **Customer** | **Manager** | N:1 (چند به یک) | هر **Customer** می‌تواند *یک* **Manager** داشته باشد، اما هر **Manager** می‌تواند با *چندین* **Customer** مرتبط باشد. |
| **Orders** | **Customer** | N:1 (چند به یک) | هر **Orders** متعلق به *یک* **Customer** است، اما هر **Customer** می‌تواند *چندین* **Orders** داشته باشد. |
| **Orders** | **Seller** | N:1 (چند به یک) | هر **Orders** توسط *یک* **Seller** انجام می‌شود، اما هر **Seller** می‌تواند *چندین* **Orders** داشته باشد. |
| **Customer** | **Orders** | 1:N (یک به چند) | (معکوس رابطه بالا) |
| **Seller** | **Orders** | 1:N (یک به چند) | (معکوس رابطه بالا) |

**توجه به محدودیت یکپارچگی کلید خارجی (Foreign Key Integrity Constraints):**

* **Customer.manager\_id:** از `ON DELETE SET NULL` استفاده شده است. اگر یک مدیر از جدول `Manager` حذف شود، فیلد `manager_id` در تمام رکوردهای مرتبط در `Customer` به `NULL` تنظیم می‌شود. این امر از از دست رفتن داده‌های مشتری جلوگیری می‌کند.
* **Orders.cust\_id** و **Orders.seller\_id:** از `ON DELETE CASCADE` استفاده شده است. اگر یک خریدار یا فروشنده از سیستم حذف شود، تمام رکوردهای مرتبط با سفارشات در جدول `Orders` به طور خودکار حذف می‌شوند. (این برای سناریوهای آزمایشی رایج است، اما در سیستم‌های واقعی ممکن است از `RESTRICT` یا بایگانی استفاده شود.)

## ۲. وظیفه ۲: کوئری‌های SQL

**توجه:** این کوئری‌ها بر اساس فرض ایجاد شده در وظیفه ۱ نوشته شده‌اند.

### ۱. `2_1.sql`: یافتن و نمایش تمام اطلاعات هر سفارش: نام خریدار، نام فروشنده، مبلغ، تاریخ.

```sql
-- 2_1.sql
SELECT
    O.order_id AS "شماره سفارش",
    C.cust_name AS "نام خریدار",
    S.seller_name AS "نام فروشنده",
    O.amount AS "مبلغ سفارش",
    O.order_date AS "تاریخ سفارش"
FROM
    Orders O
INNER JOIN 
    Customer C ON O.cust_id = C.cust_id
INNER JOIN 
    Seller S ON O.seller_id = S.seller_id;
