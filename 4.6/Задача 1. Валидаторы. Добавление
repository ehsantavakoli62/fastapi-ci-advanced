Задача 1. Валидаторы. Добавление

from flask import Flask, request, render_template_string
from flask_wtf import FlaskForm
from wtforms import StringField, IntegerField, TextAreaField
from wtforms.validators import (
    InputRequired, Email, Length, NumberRange, Optional, ValidationError
)
import datetime

# Create an instance of the Flask application
# یک نمونه از برنامه Flask ایجاد کنید
app = Flask(__name__)

# Set a secret key for Flask-WTF forms.
# In a real application, this should be a strong, randomly generated key
# loaded from environment variables or a config file.
# یک کلید مخفی برای فرم‌های Flask-WTF تنظیم کنید.
# در یک برنامه واقعی، این باید یک کلید قوی و تصادفی باشد
# که از متغیرهای محیطی یا یک فایل پیکربندی بارگذاری می‌شود.
app.config['SECRET_KEY'] = 'a_very_secret_key_for_testing_purposes_only' 

# Define the registration form with specified validators
# فرم ثبت نام را با ولیدیتورهای مشخص شده تعریف کنید
class RegistrationForm(FlaskForm):
    """
    Form for user registration, including various validators as per task requirements.
    فرم برای ثبت نام کاربر، شامل ولیدیتورهای مختلف طبق الزامات وظیفه.
    """
    email = StringField(
        'Email', 
        validators=[
            InputRequired(message="Email is required. / ایمیل الزامی است."), 
            Email(message="Invalid email format. / فرمت ایمیل نامعتبر است.")
        ]
    )
    # Phone: Number, required, length 10 characters, positive numbers only.
    # Phone: عدد، الزامی، طول 10 کاراکتر، فقط اعداد مثبت.
    # NumberRange is used here to enforce 10 digits (from 1,000,000,000 to 9,999,999,999)
    # NumberRange در اینجا برای اعمال 10 رقم (از 1,000,000,000 تا 9,999,999,999) استفاده شده است.
    phone = IntegerField(
        'Phone', 
        validators=[
            InputRequired(message="Phone number is required. / شماره تلفن الزامی است."),
            NumberRange(
                min=1000000000, # Smallest 10-digit number / کوچکترین عدد 10 رقمی
                max=9999999999, # Largest 10-digit number / بزرگترین عدد 10 رقمی
                message="Phone number must be 10 digits and positive. / شماره تلفن باید 10 رقمی و مثبت باشد."
            )
        ]
    )
    name = StringField(
        'Name', 
        validators=[
            InputRequired(message="Name is required. / نام الزامی است.")
        ]
    )
    address = StringField(
        'Address', 
        validators=[
            InputRequired(message="Address is required. / آدرس الزامی است.")
        ]
    )
    # Index: Numbers only, required. IntegerField naturally handles this type.
    # Index: فقط اعداد، الزامی. IntegerField به طور طبیعی این نوع را مدیریت می‌کند.
    index = IntegerField(
        'Index', 
        validators=[
            InputRequired(message="Index is required. / کد پستی الزامی است.")
        ]
    )
    # Comment: Text, optional.
    # Comment: متن، اختیاری.
    comment = TextAreaField(
        'Comment', 
        validators=[
            Optional() # This field is optional / این فیلد اختیاری است
        ]
    )

@app.route('/registration', methods=['GET', 'POST'])
def registration():
    """
    Handles user registration requests.
    - On GET, displays the registration form.
    - On POST, validates the submitted data and returns errors or success.
    درخواست‌های ثبت نام کاربر را مدیریت می‌کند.
    - در GET، فرم ثبت نام را نمایش می‌دهد.
    - در POST، داده‌های ارسالی را اعتبارسنجی کرده و خطاها یا موفقیت را برمی‌گرداند.
    """
    form = RegistrationForm()
    if request.method == 'POST':
        if form.validate_on_submit():
            # If validation passes, you would typically process the data
            # e.g., save to a database, send confirmation email.
            # For this task, we just return a success message.
            # اگر اعتبارسنجی موفقیت‌آمیز باشد، معمولاً داده‌ها را پردازش می‌کنید
            # مثلاً ذخیره در پایگاه داده، ارسال ایمیل تأیید.
            # برای این وظیفه، فقط یک پیام موفقیت آمیز برمی‌گردانیم.
            return "Registration successful! / ثبت نام با موفقیت انجام شد!"
        else:
            # If validation fails, return the errors.
            # form.errors contains a dictionary of errors.
            # اگر اعتبارسنجی ناموفق باشد، خطاها را برمی‌گردانیم.
            # form.errors شامل یک دیکشنری از خطاها است.
            errors_list = form.errors
            return render_template_string("""
                <h1>Registration Errors / خطاهای ثبت نام</h1>
                <ul>
                    {% for field, errors in errors_list.items() %}
                        <li>{{ field }}:
                            <ul>
                                {% for error in errors %}
                                    <li>{{ error }}</li>
                                {% endfor %}
                            </ul>
                        </li>
                    {% endfor %}
                </ul>
            """, errors_list=errors_list)
    
    # For GET requests, display a simple HTML form (for manual testing via browser)
    # برای درخواست‌های GET، یک فرم HTML ساده (برای تست دستی از طریق مرورگر) نمایش داده می‌شود
    return render_template_string("""
        <h1>Register / ثبت نام</h1>
        <form method="POST">
            {{ form.csrf_token }} {# CSRF token for security / توکن CSRF برای امنیت #}
            <p>{{ form.email.label }}: {{ form.email() }}</p>
            <p>{{ form.phone.label }}: {{ form.phone() }}</p>
            <p>{{ form.name.label }}: {{ form.name() }}</p>
            <p>{{ form.address.label }}: {{ form.address() }}</p>
            <p>{{ form.index.label }}: {{ form.index() }}</p>
            <p>{{ form.comment.label }}: {{ form.comment() }}</p>
            <p><input type="submit" value="Register / ثبت نام"></p>
        </form>
    """, form=form)

if __name__ == '__main__':
    # Run the Flask application in debug mode for development.
    # برنامه Flask را در حالت دیباگ برای توسعه اجرا کنید.
    app.run(debug=True)
